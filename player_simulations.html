<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player Simulations | DataGaffer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0; padding: 0;
      color: #003f2e;
    }
    header {
      background: #003f2e;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
    }
    .banner {
      text-align: center;
      font-size: 20px;
      margin: 20px auto;
      color: #003f2e;
      background: #e6f4ec;
      padding: 10px;
      border-left: 6px solid #003f2e;
      width: 60%;
      border-radius: 4px;
      margin-bottom: 40px;
      margin-top: 40px;
    }
    .buttons { text-align: center; margin-bottom: 20px; }
    .buttons button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: 2px solid #003f2e;
      border-radius: 4px;
      background: white;
      color: #003f2e;
    }
    .buttons button.active {
      background: #003f2e;
      color: white;
      font-weight: bold;
    }
    .search-box {
      text-align: center;
      margin-bottom: 20px;
    }
    .search-box input {
      width: 250px;
      padding: 8px;
      font-size: 14px;
      border: 2px solid #003f2e;
      border-radius: 6px;
    }
    table {
      width: 95%;
      max-width: 1100px;
      margin: auto;
      border-collapse: collapse;
      background: white;
      font-size: 14px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 40px;
      table-layout: fixed;
    }
    th, td {
      padding: 6px;
      text-align: center;
      border: 1px solid #ccc;
      font-weight: normal;
      word-wrap: break-word;
    }
    th {
      background: #003f2e;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }
    td:first-child, th:first-child { width: 6%; }
    td:nth-child(2), th:nth-child(2) { width: 22%; font-weight: bold; }
    td:nth-child(n+3), th:nth-child(n+3) { width: 8%; }
    tr:nth-child(even) { background: #f2f2f2; }
    img { width: auto; height: 28px; vertical-align: middle; }
    .hidden { display: none; }

    /* highlight styles */
    .highlight-header { background: #fcff55 !important; color: black !important; }
    .highlight-col { background: #fff9b2 !important; color: black !important; }

    /* Player Cards */
    .card-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin: 20px auto;
      max-width: 1200px;
    }
    .player-card {
      background: white;
      border: 2px solid #003f2e;
      border-radius: 12px;
      width: 220px;
      text-align: center;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .player-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 10px;
      object-fit: cover;
    }
    .player-card h3 {
      margin: 5px 0;
      font-size: 16px;
      font-weight: bold;
    }
    .player-card p {
      margin: 3px 0;
      font-size: 13px;
    }

/* --- Mobile adjustments for player simulations --- */
@media (max-width: 925px) {
  body { overflow-x: hidden; }

  .header-logo { height: 50px !important; width: auto !important; }
  h1 { font-size: 20px !important; }

  .banner {
    width: 85% !important;
    font-size: 13px !important;
    padding: 6px !important;
    margin-top: 25px;
  }

  .buttons { margin-bottom: 30px; margin-top: 25px; }
  .buttons button {
    padding: 6px 10px !important;
    font-size: 12px !important;
    margin: 0 4px !important;
  }

  .search-box input {
    width: 180px !important;
    font-size: 12px !important;
    padding: 6px !important;
  }

  /* âœ… Make table horizontally scrollable on mobile */
  #player-stats {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  table {
    min-width: 700px;   /* âœ… force table to be wider */
    font-size: 12px !important;
    margin-bottom: 25px;
  }

  th, td {
    padding: 6px !important;
    font-size: 12px !important;
    white-space: nowrap;   /* âœ… prevent stacking inside cells */
  }

  img { width: 20px !important; height: 20px !important; }

  /* Player cards already good */
  .card-grid { gap: 12px !important; margin: 10px auto !important; }
  .player-card { width: 160px !important; padding: 10px !important; }
  .player-card img { width: 60px !important; height: 60px !important; }
  .player-card h3 { font-size: 14px !important; }
  .player-card p { font-size: 11px !important; }
}


  </style>
</head>
<body>

<!-- Header -->
<div style="background-color: #003f2e; color: white; padding: 10px 20px; position: relative; display: flex; align-items: center; justify-content: center;">
  <img src="https://cdn.prod.website-files.com/682236b4aa8cdb4803142afd/68b8aa71d38f0c8d4c140700_everything-236.png"
       alt="DG Logo" class="header-logo"
       style="height: 90px; width: auto; position: absolute; left: 20px; top: 0px; z-index: 2;" />
  <h1 style="margin: 0; font-size: 32px; font-weight: 700;">DataGaffer.com</h1>
</div>

<!-- Banner -->
<div class="banner">Top players after simulation results for todayâ€™s fixtures. /90 means average stat per simulation</div>

<!-- Buttons -->
<div class="buttons">
  <button onclick="showSection('stats', this)" id="btn-stats" class="active">Player Stats</button>
  <button onclick="showSection('cards', this)" id="btn-cards">Player Cards</button>
</div>

<!-- Search box -->
<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search player, team, or position..." onkeyup="applySearch()" />
</div>

<!-- Sections -->
<div id="player-stats"></div>
<div id="player-cards" class="hidden">
  <div id="cards-grid" class="card-grid"></div>
</div>

<script>
let allPlayers = [];
let sortConfig = { column: null, asc: false };

async function loadPlayerData() {
  const indexRes = await fetch("player_simulations/index.json");
  const files = await indexRes.json();

  let players = [];
  for (const file of files) {
    const res = await fetch("player_simulations/" + file);
    const teamPlayers = await res.json();
    const teamName = file.replace(".json","").replace(/_/g," ");

    teamPlayers.forEach(p => {
      if (
        (p.goals_per90_simulated || 0) === 0 ||
        (p.assists_per90_simulated || 0) === 0 ||
        (p.shots_per90 || 0) === 0 ||
        (p.sot_per90 || 0) === 0 ||
        (p["+1_goal_pct"] || 0) === 0 ||
        (p["+1_assist_pct"] || 0) === 0 ||
        (p.soa_pct || 0) === 0
      ) return;

      players.push({
        ...p,
        team: teamName,
        team_id: p.team_id,
        player_id: p.player_id,
        // ðŸ”¹ face from assets folder
        photo: `assets/faces/${p.player_id}.png`
      });
    });
  }
  allPlayers = players;
  return players;
}

function buildTable(players) {
  let table = `<table>
    <tr id="header-row">
      <th onclick="sortTable(0)">Team</th>
      <th onclick="sortTable(1)">Player</th>
      <th onclick="sortTable(2)">Pos</th>
      <th onclick="sortTable(3)">G/90</th>
      <th onclick="sortTable(4)">A/90</th>
      <th onclick="sortTable(5)">Sht/90</th>
      <th onclick="sortTable(6)">SOT/90</th>
      <th onclick="sortTable(7)">+1G %</th>
      <th onclick="sortTable(8)">+1A %</th>
      <th onclick="sortTable(9)">SOA %</th>
    </tr>`;

  players.forEach(p => {
    const logoPath = `assets/logos/${p.team_id}.png`;
    table += `
      <tr>
        <td><img src="${logoPath}" onerror="this.onerror=null;this.src='assets/logos/${p.team_id}.svg';" alt="${p.team}"></td>
        <td>${p.name}</td>
        <td>${p.position}</td>
        <td>${(p.goals_per90_simulated ?? 0).toFixed(2)}</td>
        <td>${(p.assists_per90_simulated ?? 0).toFixed(2)}</td>
        <td>${(p.shots_per90 ?? 0).toFixed(2)}</td>
        <td>${(p.sot_per90 ?? 0).toFixed(2)}</td>
        <td>${(p["+1_goal_pct"] ?? 0).toFixed(1)}%</td>
        <td>${(p["+1_assist_pct"] ?? 0).toFixed(1)}%</td>
        <td>${(p.soa_pct ?? 0).toFixed(1)}%</td>
      </tr>`;
  });

  table += "</table>";
  return table;
}

function buildCards(players) {
  let grid = "";
  players.forEach(p => {
    grid += `
      <div class="player-card">
        <img src="${p.photo}" alt="${p.name}" onerror="this.src='assets/faces/placeholder.png'">
        <h3>${p.name}</h3>
        <p><b>Position:</b> ${p.position}</p>
        <p><b>Goals/90:</b> ${(p.goals_per90_simulated ?? 0).toFixed(2)}</p>
        <p><b>Assists/90:</b> ${(p.assists_per90_simulated ?? 0).toFixed(2)}</p>
        <p><b>Shots/90:</b> ${(p.shots_per90 ?? 0).toFixed(2)}</p>
        <p><b>SOT/90:</b> ${(p.sot_per90 ?? 0).toFixed(2)}</p>
        <p><b>+1 Goal %:</b> ${(p["+1_goal_pct"] ?? 0).toFixed(1)}%</p>
        <p><b>+1 Assist %:</b> ${(p["+1_assist_pct"] ?? 0).toFixed(1)}%</p>
        <p><b>SOA %:</b> ${(p.soa_pct ?? 0).toFixed(1)}%</p>
      </div>
    `;
  });
  return grid;
}

function applySearch() {
  const term = document.getElementById("searchInput").value.toLowerCase();
  const filtered = allPlayers.filter(p =>
    p.name.toLowerCase().includes(term) ||
    p.team.toLowerCase().includes(term) ||
    p.position.toLowerCase().includes(term)
  );
  document.getElementById("player-stats").innerHTML = buildTable(filtered);
  document.getElementById("cards-grid").innerHTML = buildCards(filtered);
}

function sortTable(col) {
  if (sortConfig.column !== col) {
    sortConfig.asc = false;
  } else {
    sortConfig.asc = !sortConfig.asc;
  }
  sortConfig.column = col;

  let sorted = [...allPlayers];
  sorted.sort((a, b) => {
    let valA, valB;
    switch(col) {
      case 0: valA = a.team; valB = b.team; break;
      case 1: valA = a.name; valB = b.name; break;
      case 2: valA = a.position; valB = b.position; break;
      case 3: valA = a.goals_per90_simulated; valB = b.goals_per90_simulated; break;
      case 4: valA = a.assists_per90_simulated; valB = b.assists_per90_simulated; break;
      case 5: valA = a.shots_per90; valB = b.shots_per90; break;
      case 6: valA = a.sot_per90; valB = b.sot_per90; break;
      case 7: valA = a["+1_goal_pct"]; valB = b["+1_goal_pct"]; break;
      case 8: valA = a["+1_assist_pct"]; valB = b["+1_assist_pct"]; break;
      case 9: valA = a.soa_pct; valB = b.soa_pct; break;
    }
    if (typeof valA === "string") valA = valA.toLowerCase();
    if (typeof valB === "string") valB = valB.toLowerCase();
    if (valA < valB) return sortConfig.asc ? -1 : 1;
    if (valA > valB) return sortConfig.asc ? 1 : -1;
    return 0;
  });

  document.getElementById("player-stats").innerHTML = buildTable(sorted);

  // reset highlights
  document.querySelectorAll("th, td").forEach(cell => {
    cell.classList.remove("highlight-header", "highlight-col");
  });
  // highlight clicked header cell
  const headerCells = document.querySelectorAll("#player-stats table tr:first-child th");
  if (headerCells[col]) headerCells[col].classList.add("highlight-header");
  // highlight column cells
  const rows = document.querySelectorAll("#player-stats table tr");
  rows.forEach((row, i) => {
    if (i === 0) return; // skip header
    const cells = row.querySelectorAll("td");
    if (cells[col]) cells[col].classList.add("highlight-col");
  });
}

async function init() {
  const players = await loadPlayerData();
  document.getElementById("player-stats").innerHTML = buildTable(players);
}

function showSection(section, btn) {
  document.getElementById("player-stats").classList.add("hidden");
  document.getElementById("player-cards").classList.add("hidden");
  document.getElementById("player-" + section).classList.remove("hidden");

  document.querySelectorAll(".buttons button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

init();
</script>
</body>
</html>
