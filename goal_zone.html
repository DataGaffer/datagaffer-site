<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>DataGaffer Goal Zone</title>
 <style>
   body {
     font-family: Arial, sans-serif;
     background: #f8f9fa;
     margin: 0;
     padding: 0;
   }

   .header {
     background: #003f2e;
     color: white;
     padding: 10px 20px;
     position: relative;
     display: flex;
     align-items: center;
     justify-content: center;
   }
   .header h1 {
     margin: 0;
     font-size: 32px;
     font-weight: 700;
   }

   /* ‚úÖ Button row */
   .button-row {
     display: flex;
     justify-content: center;
     gap: 15px;
     margin-top: 20px;
   }
   .button-row button {
     padding: 10px 25px;
     font-size: 16px;
     font-weight: bold;
     border: none;
     cursor: pointer;
     border-radius: 5px;
     background: #ffffff;
     border: 2px solid #003f2e;
     transition: background 0.2s;
     color: rgb(0, 48, 41);
   }
   .button-row button.active {
     background: #003f2e;
     color: white;
   }
   .button-row button:hover {
     background: #003f2e;
     color: white;
   }

   .goalzone-container {
     display: flex;
     justify-content: center;
     gap: 20px;
     margin: 30px auto;
     max-width: 1000px;
   }

   .goalzone-table {
     background: #ffffff;
     border: 1.5px solid #000;
     border-collapse: collapse;
     width: 100%;
     table-layout: fixed;
   }

   .goalzone-table th {
     background: #f8ff76;
     color: #000000;
     padding: 10px;
     font-size: 14px;
     border-bottom: 1px solid #000000;
   }

   .goalzone-table th:not(:last-child),
   .goalzone-table td:not(:last-child) {
     border-right: 1px solid #000000;
   }

   .goalzone-table td {
     padding: 10px 7px;
     text-align: center;
     line-height: 0.8;
     border-bottom: 1px solid #000000;
   }

   .goalzone-table tr:nth-child(even) { background-color: #edecec; }
   .goalzone-table tr:nth-child(odd)  { background-color: #ffffff; }

   .team-logo {
     height: 28px;
   }

   /* ‚úÖ Fixed column widths (Totals tab) */
   #match-table th:nth-child(1), #match-table td:nth-child(1) { width: 80%; }
   #match-table th:nth-child(2), #match-table td:nth-child(2) { width: 20%; font-weight: bold;}
   #match-table th:nth-child(1), #match-table th:nth-child(2) { background: #a6e0ff }

   #away-table th:nth-child(1), #away-table td:nth-child(1),
   #home-table th:nth-child(1), #home-table td:nth-child(1) { width: 15%; }

   #away-table th:nth-child(2), #away-table td:nth-child(2),
   #home-table th:nth-child(2), #home-table td:nth-child(2) { width: 55%; }

   #away-table th:nth-child(3), #away-table td:nth-child(3),
   #home-table th:nth-child(3), #home-table td:nth-child(3) { width: 20%; font-weight: bold; }

   /* ‚úÖ Match tab specific widths */
   /* Give the match section its own container width so 300 + 700 + 20 gap fits cleanly */
   .goalzone-container--match { max-width: 820px; }

   /* Match mini-table (left) columns */
   #match2-table th:nth-child(1), #match2-table td:nth-child(1) { width: 80%; }
   #match2-table th:nth-child(2), #match2-table td:nth-child(2) { width: 20%; font-weight: bold; }
   #match2-table th:nth-child(1), #match2-table th:nth-child(2) { background: #a6e0ff; }

   /* Percentages mini-table (right) columns: 5 equal columns */
   #goalprob-table th:nth-child(1), #goalprob-table td:nth-child(1),
   #goalprob-table th:nth-child(2), #goalprob-table td:nth-child(2),
   #goalprob-table th:nth-child(3), #goalprob-table td:nth-child(3),
   #goalprob-table th:nth-child(4), #goalprob-table td:nth-child(4),
   #goalprob-table th:nth-child(5), #goalprob-table td:nth-child(5) { width: 20%; font-weight: bold; }

   #match2-table td,
#goalprob-table td {
  padding: 18px 7px;  /* or whatever matches logo rows */
}

/* ‚úÖ Team table column widths */
#team-table th:nth-child(1),
#team-table td:nth-child(1) {
  width: 20%;  /* Logo column narrower */
}

#team-table th:nth-child(2),
#team-table td:nth-child(2) {
  width: 60%;  /* Team name column wider */
}

#team-table th:nth-child(3),
#team-table td:nth-child(3) {
  width: 20%;  /* Total column narrower */
}


   /* ‚úÖ Hide non-active sections */
   .section { display: none; }
   .section.active { display: block; }

   .search-box {
  text-align: center;
  margin-bottom: 20px;
}
.search-box input {
  width: 250px;
  padding: 8px;
  font-size: 14px;
  border: 2px solid #003f2e;
  border-radius: 6px;
  margin-top: 20px;
}


/* --- üì± Mobile adjustments for Goal Zone --- */
@media (max-width: 925px) {
  body { overflow-x: hidden; }

  /* üîù Header & Logo */
  .header-logo { height: 50px !important; width: auto !important; }
  h1 { font-size: 20px !important; }

  /* üì¢ Banner */
  .banner {
    width: 85% !important;
    font-size: 13px !important;
    padding: 6px !important;
    margin-top: 20px;
    margin-bottom: 20px;
  }

  /* üîò Tab Buttons */
  .button-row {
    gap: 8px !important;
    margin-top: 15px !important;
  }
  .button-row button {
    padding: 6px 12px !important;
    font-size: 12px !important;
    margin: 0 4px !important;
  }

  /* üìä Main table container */
  .goalzone-container,
  .goalzone-container--match {
    max-width: 95% !important;
    gap: 10px !important;
    padding: 0 5px !important;
  }

  /* üìè Match tab row height fix (make rows same height as logo tables) */

  #match2-table td,
  #goalprob-table td {
    padding-top: 8px !important;
    padding-bottom: 8px !important;
  }


  /* ü™∂ Keep side-by-side layout */
  .goalzone-container--match {
    display: flex !important;
    flex-direction: row !important;
    justify-content: space-between !important;
  }

  /* üìè Totals Tab Table Widths */
  #match-table {
    width: 25% !important;
  }
  #away-table,
  #home-table {
    width: 40% !important;
  }

  /* üì± Hide match text, show logos (Totals tab) */
  .match-text { display: none !important; }
  .match-logos { display: flex !important; justify-content: center; gap: 6px; }

  /* üìä Make Total column wider ONLY in Totals Match table */
  #match-table th:nth-child(2),
  #match-table td:nth-child(2) {
    width: 40% !important;
    font-size: 11px !important;
    font-weight: bold !important;
  }
  #match-table th:nth-child(1),
  #match-table td:nth-child(1) {
    width: 60% !important;
  }

  /* üìè Responsive widths for Match & Team tab side-by-side tables */
  #match2-table,
  #team-table {
    width: 48% !important;
  }
  #goalprob-table,
  #teamprob-table {
    width: 48% !important;
  }

  /* üìà Tables */
  .goalzone-table {
    font-size: 11px !important;
    table-layout: fixed;
  }
  .goalzone-table th {
    font-size: 10px !important;
    padding: 4px 2px !important;
    line-height: 1.3;
  }
  .goalzone-table td {
    padding: 4px 2px !important;
    font-size: 11px !important;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* üñºÔ∏è Logos */
  .team-logo {
    height: 18px !important;
  }

  /* üß© Narrow columns for logo + total in other tables */
  #team-table th:nth-child(1), #team-table td:nth-child(1),
  #team-table th:nth-child(3), #team-table td:nth-child(3),
  #away-table th:nth-child(1), #away-table td:nth-child(1),
  #home-table th:nth-child(1), #home-table td:nth-child(1) {
    width: 15% !important;
  }

  /* üìâ Optional narrower total column in team table */
  #team-table th:nth-child(3), #team-table td:nth-child(3) {
    width: 20% !important;
  }

  /* üìä Bold the numbers in Team tab */
#team-table td:nth-child(3),
#team-table th:nth-child(3) {
  font-weight: bold !important;
}


  /* üìä Ensure percentage table columns stay readable */
  #goalprob-table th,
  #goalprob-table td,
  #teamprob-table th,
  #teamprob-table td {
    font-size: 10px !important;
    padding: 4px 2px !important;
    font-weight: bold;
  }

  #away-table th:nth-child(1),
  #away-table td:nth-child(1),
  #home-table th:nth-child(1),
  #home-table td:nth-child(1) {
    width: 20% !important; /* üîÅ adjust 18‚Äì22% if you want more or less space */
  }

  /* Shift the name column slightly narrower to compensate */
  #away-table th:nth-child(2),
  #away-table td:nth-child(2),
  #home-table th:nth-child(2),
  #home-table td:nth-child(2) {
    width: 50% !important;
  }

  /* Keep total column width balanced */
  #away-table th:nth-child(3),
  #away-table td:nth-child(3),
  #home-table th:nth-child(3),
  #home-table td:nth-child(3) {
    width: 30% !important;
  }
}



</style>
</head>
<body>

<!-- üîù New Header with Logo -->
<div style="background-color: #003f2e; color: white; padding: 10px 20px; position: relative; display: flex; align-items: center; justify-content: center;">
  <a href="dashboard.html" style="text-decoration: none; color: inherit; display: contents;">
    <img 
      src="https://cdn.prod.website-files.com/682236b4aa8cdb4803142afd/68b8aa71d38f0c8d4c140700_everything-236.png"
      alt="DG Logo"
      class="header-logo"
      style="height: 90px; width: auto; position: absolute; left: 20px; top: 0px; z-index: 2;" 
    />
    <h1 style="margin: 0; font-size: 32px; font-weight: 700;">DataGaffer.com</h1>
  </a>
</div>

<!-- üìä Banner -->
<div class="banner" style="
  text-align: center;
  font-size: 20px;
  margin: 20px auto;
  color: #003f2e;
  background: #e6f4ec;
  padding: 10px;
  border-left: 6px solid #003f2e;
  width: 60%;
  border-radius: 4px;
  margin-bottom: 40px;
  margin-top: 40px;
">
  Goal totals, scoring probabilities, and team stats from 5,000 simulations
</div>


<!-- ‚úÖ Button Row -->
<div class="button-row">
 <button class="tab-button active" data-target="totals-section">Totals</button>
 <button class="tab-button" data-target="match-section">Match</button>
 <button class="tab-button" data-target="team-section">Team</button>
</div>

<!-- üîç Search Box -->
<div class="search-box">
  <input 
    type="text" 
    id="searchInput" 
    placeholder="Search team, matchup, or league..." 
    onkeyup="applySearch()" 
  />
</div>



<!-- ‚úÖ Totals Section (your current table wrapped) -->
<div id="totals-section" class="section active">
 <div class="goalzone-container">
   <table class="goalzone-table" id="match-table">
     <thead>
       <tr><th>Match</th><th>Total</th></tr>
     </thead>
     <tbody id="match-body"></tbody>
   </table>

   <table class="goalzone-table" id="home-table">
     <thead>
       <tr><th></th><th>Home</th><th>Total</th></tr>
     </thead>
     <tbody id="home-body"></tbody>
   </table>

   <table class="goalzone-table" id="away-table">
     <thead>
       <tr><th></th><th>Away</th><th>Total</th></tr>
     </thead>
     <tbody id="away-body"></tbody>
   </table>
 </div>
</div>

<!-- ‚úÖ Match Section (two mini tables side-by-side with fixed widths) -->
<div id="match-section" class="section">
  <div class="goalzone-container goalzone-container--match">
    <!-- Left: Match | Total (300px) -->
    <table class="goalzone-table" id="match2-table" style="width:400px">
      <thead>
        <tr><th>Match</th><th>Total</th></tr>
      </thead>
      <tbody id="match2-body"></tbody>
    </table>

    <!-- Right: Percentages 1+..5+ (700px), no Match column -->
    <table class="goalzone-table" id="goalprob-table" style="width:400px">
      <thead>
        <tr><th>1+</th><th>2+</th><th>3+</th><th>4+</th><th>5+</th></tr>
      </thead>
      <tbody id="goalprob-body"></tbody>
    </table>
  </div>
</div>

<div id="team-section" class="section">
  <div class="goalzone-container goalzone-container--match">
    <table class="goalzone-table" id="team-table" style="width:400px">
      <thead>
        <tr><th></th><th>Team</th><th>Total</th></tr>
      </thead>
      <tbody id="team-body"></tbody>
    </table>

    <table class="goalzone-table" id="teamprob-table" style="width:400px">
      <thead>
        <tr><th>1+</th><th>2+</th><th>3+</th><th>4+</th><th>5+</th></tr>
      </thead>
      <tbody id="teamprob-body"></tbody>
    </table>
  </div>
</div>


<!-- ‚úÖ Empty Team Section placeholder (unchanged) -->
<div id="team-section" class="section"></div>


<script>
let allFixtures = []; // ‚úÖ store fixtures globally

// ‚úÖ Gradient helpers
function colorFromRatio(ratio, colorLow, colorHigh) {
  const r = Math.round(colorLow.r + ratio * (colorHigh.r - colorLow.r));
  const g = Math.round(colorLow.g + ratio * (colorHigh.g - colorLow.g));
  const b = Math.round(colorLow.b + ratio * (colorHigh.b - colorLow.b));
  return `rgb(${r},${g},${b})`;
}

function getValueGradient(value, min, max) {
  if (!isFinite(value)) return "white";
  const ratio = (value - min) / (max - min + 1e-6);

  if (ratio < 0.5) {
    const t = ratio / 0.5;
    return colorFromRatio(t, { r: 255, g: 100, b: 100 }, { r: 255, g: 255, b: 255 });
  } else {
    const t = (ratio - 0.5) / 0.5;
    return colorFromRatio(t, { r: 255, g: 255, b: 255 }, { r: 0, g: 200, b: 0 });
  }
}

// ‚úÖ Poisson helpers
function factorial(n) {
  let r = 1;
  for (let i = 2; i <= n; i++) r *= i;
  return r;
}
function poissonPMF(k, lambda) {
  return Math.exp(-lambda) * Math.pow(lambda, k) / factorial(k);
}
function probAtLeast(n, lambda) {
  if (n <= 0) return 1;
  let cdf = 0;
  for (let k = 0; k <= n - 1; k++) cdf += poissonPMF(k, lambda);
  return 1 - cdf;
}

// ‚úÖ Core render function ‚Äî rebuilds everything from a filtered dataset
function renderEverything(fixtures) {
  // Elements
  const matchBody = document.getElementById("match-body");
  const awayBody = document.getElementById("away-body");
  const homeBody = document.getElementById("home-body");
  const match2Body = document.getElementById("match2-body");
  const goalprobBody = document.getElementById("goalprob-body");
  const teamBody = document.getElementById("team-body");
  const teamProbBody = document.getElementById("teamprob-body");

  // Reset
  matchBody.innerHTML = "";
  awayBody.innerHTML = "";
  homeBody.innerHTML = "";
  match2Body.innerHTML = "";
  goalprobBody.innerHTML = "";
  teamBody.innerHTML = "";
  teamProbBody.innerHTML = "";

  // Build data arrays
  const matches = fixtures.map(f => ({
    match: `${f.home.name} vs ${f.away.name}`,
    total: parseFloat(f.sim_stats.xg.total),
    home: { name: f.home.name, logo: f.home_logo, val: parseFloat(f.sim_stats.xg.home) },
    away: { name: f.away.name, logo: f.away_logo, val: parseFloat(f.sim_stats.xg.away) }
  }));

  const sortedMatches = [...matches].sort((a, b) => b.total - a.total);

// ‚úÖ Always use global full dataset for gradient min/max
const allMatchesFull = allFixtures.map(f => ({
  total: parseFloat(f.sim_stats.xg.total),
  homeVal: parseFloat(f.sim_stats.xg.home),
  awayVal: parseFloat(f.sim_stats.xg.away)
}));

const totalMin = Math.min(...allMatchesFull.map(m => m.total));
const totalMax = Math.max(...allMatchesFull.map(m => m.total));
const homeMin  = Math.min(...allMatchesFull.map(m => m.homeVal));
const homeMax  = Math.max(...allMatchesFull.map(m => m.homeVal));
const awayMin  = Math.min(...allMatchesFull.map(m => m.awayVal));
const awayMax  = Math.max(...allMatchesFull.map(m => m.awayVal));

  // ‚úÖ Fill Totals tab
  sortedMatches.forEach(m => {
    matchBody.innerHTML += `
      <tr>
        <td>
          <span class="match-text">${m.match}</span>
          <span class="match-logos" style="display:none;">
            <img src="${m.home.logo}" class="team-logo">
            <img src="${m.away.logo}" class="team-logo">
          </span>
        </td>
        <td style="background:${getValueGradient(m.total,totalMin,totalMax)}">${m.total.toFixed(2)}</td>
      </tr>`;

    awayBody.innerHTML += `
      <tr>
        <td><img src="${m.away.logo}" class="team-logo"></td>
        <td>${m.away.name}</td>
        <td style="background:${getValueGradient(m.away.val,awayMin,awayMax)}">${m.away.val.toFixed(2)}</td>
      </tr>`;

    homeBody.innerHTML += `
      <tr>
        <td><img src="${m.home.logo}" class="team-logo"></td>
        <td>${m.home.name}</td>
        <td style="background:${getValueGradient(m.home.val,homeMin,homeMax)}">${m.home.val.toFixed(2)}</td>
      </tr>`;
  });

  // ‚úÖ Fill Match tab - Left table
  matches.forEach(m => {
    match2Body.innerHTML += `
      <tr>
        <td>${m.match}</td>
        <td style="background:${getValueGradient(m.total,totalMin,totalMax)}">${m.total.toFixed(2)}</td>
      </tr>`;
  });

const allProbabilitiesFull = allFixtures.map(f => {
  const total = parseFloat(f.sim_stats.xg.total);
  return {
    p1: probAtLeast(1, total) * 100,
    p2: probAtLeast(2, total) * 100,
    p3: probAtLeast(3, total) * 100,
    p4: probAtLeast(4, total) * 100,
    p5: probAtLeast(5, total) * 100
  };
});

const p1Min = Math.min(...allProbabilitiesFull.map(p => p.p1));
const p1Max = Math.max(...allProbabilitiesFull.map(p => p.p1));
const p2Min = Math.min(...allProbabilitiesFull.map(p => p.p2));
const p2Max = Math.max(...allProbabilitiesFull.map(p => p.p2));
const p3Min = Math.min(...allProbabilitiesFull.map(p => p.p3));
const p3Max = Math.max(...allProbabilitiesFull.map(p => p.p3));
const p4Min = Math.min(...allProbabilitiesFull.map(p => p.p4));
const p4Max = Math.max(...allProbabilitiesFull.map(p => p.p4));
const p5Min = Math.min(...allProbabilitiesFull.map(p => p.p5));
const p5Max = Math.max(...allProbabilitiesFull.map(p => p.p5));

  function getBlueGradient(value, min, max) {
    if (!isFinite(value)) return "white";
    const ratio = (value - min) / (max - min + 1e-6);
    return colorFromRatio(ratio, { r: 255, g: 255, b: 255 }, { r: 77, g: 170, b: 255 });
  }

  matches.forEach(m => {
    const lam = m.total;
    const p1 = Math.round(probAtLeast(1, lam) * 100);
    const p2 = Math.round(probAtLeast(2, lam) * 100);
    const p3 = Math.round(probAtLeast(3, lam) * 100);
    const p4 = Math.round(probAtLeast(4, lam) * 100);
    const p5 = Math.round(probAtLeast(5, lam) * 100);

    goalprobBody.innerHTML += `
      <tr>
        <td style="background:${getBlueGradient(p1,p1Min,p1Max)}">${p1}%</td>
        <td style="background:${getBlueGradient(p2,p2Min,p2Max)}">${p2}%</td>
        <td style="background:${getBlueGradient(p3,p3Min,p3Max)}">${p3}%</td>
        <td style="background:${getBlueGradient(p4,p4Min,p4Max)}">${p4}%</td>
        <td style="background:${getBlueGradient(p5,p5Min,p5Max)}">${p5}%</td>
      </tr>`;
  });

  // ‚úÖ TEAM TAB
  const teams = [];
  matches.forEach(m => {
    teams.push({ name: m.home.name, logo: m.home.logo, total: m.home.val });
    teams.push({ name: m.away.name, logo: m.away.logo, total: m.away.val });
  });

  const teamTotals = teams.map(t => t.total);
  const teamMin = Math.min(...teamTotals);
  const teamMax = Math.max(...teamTotals);

  teams.forEach(t => {
    teamBody.innerHTML += `
      <tr>
        <td><img src="${t.logo}" class="team-logo"></td>
        <td>${t.name}</td>
        <td style="background:${getValueGradient(t.total,teamMin,teamMax)}">${t.total.toFixed(2)}</td>
      </tr>`;
  });

  const allTP1 = teams.map(t => probAtLeast(1, t.total) * 100);
  const allTP2 = teams.map(t => probAtLeast(2, t.total) * 100);
  const allTP3 = teams.map(t => probAtLeast(3, t.total) * 100);
  const allTP4 = teams.map(t => probAtLeast(4, t.total) * 100);
  const allTP5 = teams.map(t => probAtLeast(5, t.total) * 100);

  const tp1Min = Math.min(...allTP1), tp1Max = Math.max(...allTP1);
  const tp2Min = Math.min(...allTP2), tp2Max = Math.max(...allTP2);
  const tp3Min = Math.min(...allTP3), tp3Max = Math.max(...allTP3);
  const tp4Min = Math.min(...allTP4), tp4Max = Math.max(...allTP4);
  const tp5Min = Math.min(...allTP5), tp5Max = Math.max(...allTP5);

  teams.forEach(t => {
    const p1 = Math.round(probAtLeast(1, t.total) * 100);
    const p2 = Math.round(probAtLeast(2, t.total) * 100);
    const p3 = Math.round(probAtLeast(3, t.total) * 100);
    const p4 = Math.round(probAtLeast(4, t.total) * 100);
    const p5 = Math.round(probAtLeast(5, t.total) * 100);

    teamProbBody.innerHTML += `
      <tr>
        <td style="background:${getBlueGradient(p1,tp1Min,tp1Max)}">${p1}%</td>
        <td style="background:${getBlueGradient(p2,tp2Min,tp2Max)}">${p2}%</td>
        <td style="background:${getBlueGradient(p3,tp3Min,tp3Max)}">${p3}%</td>
        <td style="background:${getBlueGradient(p4,tp4Min,tp4Max)}">${p4}%</td>
        <td style="background:${getBlueGradient(p5,tp5Min,tp5Max)}">${p5}%</td>
      </tr>`;
  });
}

// ‚úÖ Search with gradient recalculation
function applySearch() {
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  const filtered = allFixtures.filter(f =>
    f.home.name.toLowerCase().includes(searchTerm) ||
    f.away.name.toLowerCase().includes(searchTerm) ||
    `${f.home.name} vs ${f.away.name}`.toLowerCase().includes(searchTerm) ||
    (f.league && f.league.name.toLowerCase().includes(searchTerm))
  );
  renderEverything(filtered.length ? filtered : allFixtures);
}

// ‚úÖ Button toggle logic (fixed)
document.querySelectorAll('.tab-button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(btn.dataset.target).classList.add('active');
  });
});

// ‚úÖ Initial load
fetch("fixtures.json")
  .then(res => res.json())
  .then(data => {
    allFixtures = data;
    renderEverything(allFixtures);
  });
</script>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* --- Supabase setup --- */
const SUPABASE_URL = "https://qgniftwopmhhcwiatkku.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbmlmdHdvcG1oaGN3aWF0a2t1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjc2MzMsImV4cCI6MjA3MzgwMzYzM30.TYHTz4d9bT7OjdEkmu0m5lu-St75BWHOJQd8FLcKm5E";  // replace with your anon key
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* --- Inactivity logout (15 minutes) --- */
const INACTIVITY_LIMIT = 15 * 60 * 1000; // 15 minutes
let inactivityTimer;

function resetInactivityTimer() {
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(async () => {
    console.log("Auto-logout after inactivity");
    await supabaseClient.auth.signOut();
    window.location.href = "login.html";
  }, INACTIVITY_LIMIT);
}

// Reset timer on user activity
["click","mousemove","keydown","scroll","touchstart"].forEach(evt =>
  document.addEventListener(evt, resetInactivityTimer)
);

// Start timer when page loads
resetInactivityTimer();

/* --- Explicit logout handling --- */
supabaseClient.auth.onAuthStateChange((event) => {
  if (event === "SIGNED_OUT") {
    console.log("User signed out ‚Üí redirecting to login");
    window.location.href = "login.html";
  }
});
</script>


<script>
document.addEventListener("DOMContentLoaded", async () => {
  const { data, error } = await supabaseClient.auth.getSession();
  console.log("DEBUG session:", data?.session);
  console.log("DEBUG error:", error);

  supabaseClient.auth.onAuthStateChange((event, session) => {
    console.log("DEBUG auth event:", event, session);
  });
});
</script>




</body>
</html>

